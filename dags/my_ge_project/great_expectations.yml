# great_expectations.yml
# Version: 3
#
# This configuration is tailored for your environment where:
# • Raw data (e.g., ut_loss_history_1.csv) resides in the S3 bucket "grange-seniordesign-bucket"
#   under the prefix "raw-data/"
# • All Great Expectations artifacts (expectations, validations, checkpoints, data docs) are
#   stored in S3 under the "great_expectations/" prefix.
#
# Considerations for future enhancements:
#   - Datasource Adjustments: To support additional file types or modify the regex pattern,
#     update the 'pattern' under default_regex.
#   - Customizations/Overrides: You can override default behaviors using environment variables
#     or Airflow Variables. For instance, you might later switch between local and S3 storage for data docs.
#   - Data Docs Accessibility: To make GE data docs publicly accessible, update your S3 bucket policy
#     for the "great_expectations/data_docs" prefix.
#   - Additional Stores: An optional local store is provided below (commented out) for backup.
#

version: 3

# --- Datasources ---
# Defines how GE connects to your data.
# This datasource is configured to read CSV files from S3 under the "raw-data/" prefix.
datasources:
  my_s3_datasource:
    class_name: Datasource
    module_name: great_expectations.datasource  # Optional; can be omitted if using defaults
    execution_engine:
      class_name: PandasExecutionEngine  # Change to SparkDFExecutionEngine if needed
    data_connectors:
      default_inferred_data_connector_name:
        class_name: InferredAssetS3DataConnector
        bucket: grange-seniordesign-bucket       # Your S3 bucket containing raw data
        prefix: raw-data                          # Folder where ut_loss_history_1.csv is stored
        default_regex:
          pattern: (.*)\.csv                       # Adjust if additional file types are needed
          group_names:
            - data_asset_name

# --- Stores ---
# These stores persist GE artifacts on S3.
stores:
  expectations_S3_store:
    class_name: ExpectationsStore
    store_backend:
      class_name: TupleS3StoreBackend
      bucket: grange-seniordesign-bucket
      prefix: great_expectations/expectations   # S3 folder for expectation suites
  validations_S3_store:
    class_name: ValidationsStore
    store_backend:
      class_name: TupleS3StoreBackend
      bucket: grange-seniordesign-bucket
      prefix: great_expectations/validations     # S3 folder for validation results
  checkpoint_S3_store:
    class_name: CheckpointStore
    store_backend:
      class_name: TupleS3StoreBackend
      bucket: grange-seniordesign-bucket
      prefix: great_expectations/checkpoints     # S3 folder for checkpoints
  evaluation_parameter_store:
    class_name: EvaluationParameterStore

# --- Optional Local Store ---
# Uncomment the below section if you wish to create a local backup of your expectation suites.
# expectations_local_store:
#   class_name: ExpectationsStore
#   store_backend:
#     class_name: TupleFilesystemStoreBackend
#     base_directory: great_expectations/uncommitted/expectations_backup

# Set default store references
expectations_store_name: expectations_S3_store
validations_store_name: validations_S3_store
checkpoint_store_name: checkpoint_S3_store

# --- Data Docs ---
# Data docs provide a web interface for your GE validations and expectations.
data_docs_sites:
  s3_site:
    class_name: SiteBuilder
    store_backend:
      class_name: TupleS3StoreBackend
      bucket: grange-seniordesign-bucket
      prefix: great_expectations/data_docs          # S3 folder for data docs
    site_index_builder:
      class_name: DefaultSiteIndexBuilder

# To allow public access, update your S3 bucket policy for the "great_expectations/data_docs" prefix.

# --- Customizations and Overrides ---
# Overrides (such as switching datasources or altering store settings) can be managed
# using environment variables or Airflow Variables. No additional overrides are included by default.

# --- Anonymous Usage Statistics ---
# Disable sending anonymous usage statistics to Great Expectations.
anonymous_usage_statistics:
  enabled: false
